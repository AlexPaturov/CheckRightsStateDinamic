@page "/"
@inject GetUserRights userRights

<ul class="list-group">
    <li class="list-group-item d-flex justify-content-between align-items-center">
        Проверка прав ПК
        <span class="badge @PcRightsBadge">@PcRightsMessage</span>
    </li>

    <li class="list-group-item d-flex justify-content-between align-items-center">
        Проверка прав пользователя
        <span class="badge @UserRightsBadge">@UserRightsMessage</span>
    </li>
</ul>

@code {
    private string pcName = Environment.MachineName;
    private string userName = Environment.UserDomainName;

    private bool? UserRights = null;
    private bool? PcRights = null;

    // Status messages
    private string PcRightsMessage = "Ожидает проверки";
    private string UserRightsMessage = "Ожидает проверки";

    // CSS classes for badges
    private string PcRightsBadge = "bg-secondary";
    private string UserRightsBadge = "bg-secondary";

    protected override async void OnInitialized()
    {
        // Check PC Rights
        PcRightsBadge = "bg-info"; // Checking
        PcRightsMessage = "Проверяется";
        StateHasChanged(); // Trigger re-render

        try
        {
            PcRights = await userRights.CheckPcRights(pcName);
            if (PcRights == true)
            {
                PcRightsBadge = "bg-success";
                PcRightsMessage = "Успешно";
            }
            else
            {
                PcRightsBadge = "bg-danger";
                PcRightsMessage = "Ошибка проверки";
            }
        }
        catch
        {
            PcRightsBadge = "bg-danger";
            PcRightsMessage = "Ошибка при проверке";
        }
        StateHasChanged(); // Re-render to update PC rights

        // Check User Rights
        UserRightsBadge = "bg-info"; // Checking
        UserRightsMessage = "Проверяется";
        StateHasChanged(); // Trigger re-render

        try
        {
            UserRights = await userRights.CheckUserRights(userName);
            if (UserRights == true)
            {
                UserRightsBadge = "bg-success";
                UserRightsMessage = "Успешно";
            }
            else
            {
                UserRightsBadge = "bg-danger";
                UserRightsMessage = "Ошибка проверки";
            }
        }
        catch
        {
            UserRightsBadge = "bg-danger";
            UserRightsMessage = "Ошибка при проверке";
        }
        StateHasChanged(); // Re-render to update user rights
    }
}
